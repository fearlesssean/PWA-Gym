<template id="cycle-form">
    <div class="mt-4 p-5 bg-primary text-white rounded">
        <h1>
            <slot name="title"></slot>
        </h1>
        <form>
            <input id="title" type="text" name="title" hidden>
            <slot name="sets-input"></slot>
            <button type="submit">Save</button>
        </form>
    </div>
</template>

<template id="sets-input">
    <div class="input-group mb-3">
        <span class="input-group-text">
            <slot name="reps-count"></slot>x
        </span>
        <input id="set1" type="number" class="form-control" name="set1" placeholder="Reps" required>
    </div>
</template>

<script>
    // Shared Bootstrap <link> element
    const bootstrapLink = document.createElement('link');
    bootstrapLink.rel = 'stylesheet';
    bootstrapLink.href = 'https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css';

    class CycleForm extends HTMLElement {
        constructor() {
            super();
            const template = document.getElementById('cycle-form').content;
            const shadowRoot = this.attachShadow({ mode: 'open' });

            // Clone and append shared Bootstrap link
            shadowRoot.appendChild(bootstrapLink.cloneNode());
            shadowRoot.appendChild(template.cloneNode(true));
        }
    }

    class SetsInput extends HTMLElement {
        constructor() {
            super();
            const shadowRoot = this.attachShadow({ mode: 'open' });

            // Create a container for the inputs
            this.container = document.createElement('div');
            shadowRoot.appendChild(this.container);

            // Add Bootstrap CSS
            shadowRoot.appendChild(bootstrapLink.cloneNode());

            // Generate inputs dynamically
            this.generateInputs();
        }

        // Watch for changes to the data-sets attribute
        static get observedAttributes() {
            return ['data-sets'];
        }

        attributeChangedCallback(name, oldValue, newValue) {
            if (name === 'data-sets' && oldValue !== newValue) {
                this.generateInputs();
            }
        }

        generateInputs() {
            const sets = parseInt(this.getAttribute('data-sets')) || 1; // Default to 1 if no data-sets provided
            const shadowRoot = this.shadowRoot;

            // Clear the container before regenerating
            this.container.innerHTML = '';

            for (let i = 1; i <= sets; i++) {
                const group = document.createElement('div');
                group.className = 'input-group mb-3';

                const span = document.createElement('span');
                span.className = 'input-group-text';
                span.textContent = `Set ${i}:`;

                const input = document.createElement('input');
                input.type = 'number';
                input.className = 'form-control';
                input.name = `set${i}`;
                input.placeholder = `Reps for set ${i}`;
                input.required = true;

                group.appendChild(span);
                group.appendChild(input);
                this.container.appendChild(group);
            }
        }
    }

    customElements.define('sets-input', SetsInput);
    customElements.define('cycle-form', CycleForm);
</script>